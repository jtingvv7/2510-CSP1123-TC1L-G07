{% extends "base.html" %}
{% block title %}Announcements{% endblock %}

{% block content %}
<div class="container-fluid py-4" style="background-color: #f8f9fa; min-height: calc(100vh - 80px);">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="card shadow-sm border border-secondary">
        <div class="card-header bg-dark text-white fs-4 text-center">
          <i class="bi bi-megaphone-fill"></i> Official Announcements
        </div>
        <div class="card-body">
          {% if announcements %}
            {% for a in announcements %}
              <!-- (user_id==None) for everyone -->
              {% if not a.user_id or a.user_id == current_user.id %}
              <div class="mb-4 p-4 bg-light border rounded text-center">
                <h4 class="mb-3">
                  <i class="bi bi-megaphone text-secondary"></i> {{ a.title }}
                </h4>
                <p class="fs-5">{{ a.content }}</p>

                {# if about report add button #}
                {% if a.report_id %}
                  {% if not a.expires_at or a.expires_at.replace(tzinfo=None) > now.replace(tzinfo=None) %}
                    <a href="{{ url_for('report.my_reports') }}"
                       class="btn btn-info btn-sm">
                      <i class="bi bi-journay-text"></i> View in My Reports
                    </a>
                  {% endif %}
                {% endif %}

                <small class="text-muted d-block mt-2">
                  Posted on {{ (a.created_at + timedelta(hours=8)).strftime('%Y-%m-%d %H:%M') }}
                  {% if a.expires_at %}
                    {% if a.expires_at.replace(tzinfo=None) < now.replace(tzinfo=None) %}
                      <span class="text-danger">(Expired)</span>
                    {% else %}
                      (valid until {{ (a.expires_at + timedelta(hours=8)).strftime('%Y-%m-%d %H:%M') }})
                    {% endif %}
                  {% endif %}
                </small>
              </div>
              {% endif %}
            {% endfor %}
          {% else %}
            <p class="text-muted fs-5 text-center">No announcements yet.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}