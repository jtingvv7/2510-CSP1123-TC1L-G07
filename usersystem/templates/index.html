<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:30px; }
    .checkout-box { background:#fff; padding:20px; width:500px; margin:auto; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,.1); }
    .checkout-box h2 { color:#ee4d2d; margin-bottom:20px; }
    .payment-method { display:flex; align-items:center; border:2px solid #ddd; padding:10px; margin-bottom:10px; border-radius:8px; cursor:pointer; transition:.3s; }
    .payment-method img { width:60px; margin-right:15px; }
    .payment-method:hover { border-color:#ee4d2d; }
    input[type="radio"] { display:none; }
    input[type="radio"]:checked + label { border-color:#ee4d2d; background:#fff4f1; }
    .pay-btn { background:#ee4d2d; color:#fff; border:none; padding:12px 20px; border-radius:8px; font-size:16px; cursor:pointer; width:100%; }
    .pay-btn:hover { background:#d63c1f; }
  </style>
</head>
<body>
  <div class="checkout-box">
    <h2>Checkout</h2>
    <p>Order: <b>{{ order.order_id }}</b></p>
    <p>Total: <b>RM {{ '%.2f' % (order.amount/100) }}</b></p>

    <div>
      <input type="radio" id="card" name="payment_method" value="card" checked>
      <label class="payment-method" for="card">
        <img src="https://img.icons8.com/color/96/visa.png" alt="Card"> Credit/Debit Card
      </label>
    </div>
    <div>
      <input type="radio" id="grabpay" name="payment_method" value="grabpay">
      <label class="payment-method" for="grabpay">
        <img src="https://img.icons8.com/color/96/google-pay.png" alt="GrabPay"> GrabPay (Wallet)
      </label>
    </div>
    <div>
      <input type="radio" id="fpx" name="payment_method" value="fpx">
      <label class="payment-method" for="fpx">
        <img src="https://img.icons8.com/color/96/bank-building.png" alt="FPX"> Online Banking (FPX)
      </label>
    </div>

    <button class="pay-btn" id="payBtn">Proceed to Pay</button>
  </div>

<script>
  document.getElementById('payBtn').addEventListener('click', async () => {
    const selected = document.querySelector('input[name="payment_method"]:checked').value;

    try {
      const res = await fetch('/create-checkout-session', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ payment_method: selected })
      });

      if (!res.ok) {
        throw new Error("Server returned " + res.status);
      }

      const data = await res.json();

      if (data.url) {
        window.location.href = data.url; // to Stripe Checkout
      } else {
        alert("Error: " + JSON.stringify(data));
      }
    } catch (err) {
      alert("Fetch error: " + err);
      console.error(err);
    }
  });
</script>
</body>
</html>