{% extends "base.html" %}
{% block title %} Manage Products {% endblock %}

{% block content %}
<style>
  body {
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, oklch(83.693% 0.02258 17.382), lch(91.75% 2.15 19.27));
    min-height: 100vh;
  }
</style>

<div class="container-fluid py-4" style="min-height: calc(100vh - 80px);">
  <div class="row justify-content-center">
    <div class="col-lg-11">
      <div class="card shadow border-0">
        <!-- header -->
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
          <h4 class="fw-bold mb-0"><i class="bi bi-box-seam"></i> Manage Products</h4>
          <a href="{{ url_for('admin.add_product') }}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Add Product
          </a>
        </div>

        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered table-hover table-striped align-middle text-center mb-0">
              <thead class="table-dark">
                <tr>
                  <th>#</th>
                  <th>Image</th>
                  <th>Name</th>
                  <th>Price (RM)</th>
                  <th>Description</th>
                  <th>Seller</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for p in products %}
                <tr>
                  <td>{{ p.id }}</td>
                  <td>
                    {% if p.image %}
                      <img src="{{ get_image_url(p.image) }}" width="60" class="img-thumbnail">
                    {% else %}
                      <img src="{{ url_for('static', filename='uploads/products/default_product.jpg') }}" width="60" class="img-thumbnail">
                    {% endif %}
                  </td>
                  <td>{{ p.name }}</td>
                  <td>{{ "%.2f"|format(p.price) }}</td>
                  <td>{{ p.description[:30] }}{% if p.description|length > 30 %}...{% endif %}</td>
                  <td>
                    {% if p.seller %}
                      {{ p.seller.name }}
                    {% else %}
                      <span class="text-muted">Unknown</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if not p.is_sold %}
                      <span class="badge bg-success px-3 py-2">Active</span>
                    {% else %}
                      <span class="badge bg-secondary px-3 py-2">Inactive</span>
                    {% endif %}
                  </td>
                  <td>
                    <div class="d-grid gap-2">
                      <a href="{{ url_for('admin.edit_product', product_id=p.id)}}" class="btn btn-sm btn-outline-primary">Edit</a>
                      <form action="{{ url_for('admin.delete_product', product_id=p.id)}}" method="POST">
                        <button type="submit" class="btn btn-sm btn-outline-danger"
                          onclick="return confirm('Are you sure you want to delete this product?');">
                          Delete
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
{% endblock %}