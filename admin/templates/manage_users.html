{% extends "base.html" %}
{% block title %} Manage Users {% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">Manage Users</h2>

    <!--user-->
    <div class="card shadow">
        <div class="card-body">
            <table class="table table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Username</th>
                        <th scope="col">Email</th>
                        <th scope="col">Role</th>
                        <th scope="col">Join Date</th>
                        <th scope="col" class="text-center">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %}
                    <tr>
                        <td>{{ u.id }}</td>
                        <td>
                            <strong>{{ u.name }}</strong>
                        </td>
                        <td>{{ u.email }}</td>
                        <td>
                            {% if u.role == "admin" %}
                                <span class="badge bg-primary">Admin</span>
                            {% else %}
                                <span class="badge bg-secondary">User</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if u.join_date %}
                                {{ u.join_date.strftime("%Y-%m-%d") }}
                            {% else %}
                             -----
                            {% endif %}
                        </td>
                        <td class="text-center">

                            <!--make admin-->
                            {% if u.role != "admin" %}
                            <form action="{{ url_for('admin.make_admin', user_id=u.id)}}" method="POST" class="d-inline">
                                <input type="hidden" name="role" value="admin"> <!--no exist when user already is admin-->
                                <button class="btn btn-sm btn-outline-primary"
                                    onclick="return confirm('Promote {{u.name}} to Admin?')">
                                Make Admin
                                </button>
                            </form>
                            {% endif %}

                            <!--delete user-->
                            {% if u.id != current_user.id %}
                            <form action="{{ url_for('admin.delete_user', user_id=u.id)}}" method="POST" class="d-inline">
                                <button class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('Are you sure you want to delete{{ u.name }}?')">
                                Delete
                                </button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}